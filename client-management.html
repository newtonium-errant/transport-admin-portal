<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RRTS - Client Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8em;
            font-weight: 300;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: background-color 0.3s ease;
        }

        .nav-links a:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .nav-links a.active {
            background-color: rgba(255,255,255,0.2);
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-hint {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .lookup-section {
            background: white;
            border: 1px solid #3498db;
        }

        .lookup-section h3 {
            border-bottom-color: #e74c3c;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .client-status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .status-found {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-new {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #3498db;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .appointment-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
        }

        .appointment-item.modified {
            border-color: #f39c12;
            background-color: #fef9e7;
        }

        .appointment-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .delete-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .validation-error {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .required {
            color: #e74c3c;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .container {
                margin: 10px;
            }
            
            .content {
                padding: 20px;
            }

            .nav-links {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Rural Route Transportation Services - Client Management</h1>
            <div class="nav-links">
                <a href="dashboard.html">Dashboard</a>
                <a href="client-management.html" class="active">Clients</a>
                <a href="operations.html">Operations</a>
                <a href="driver-management.html">Drivers</a>
                <a href="admin.html">Admin</a>
                <a href="#" onclick="logout()">Logout</a>
            </div>
        </div>

        <div class="content">
            <!-- Client Lookup Section -->
            <div class="section lookup-section">
                <h3>üîç Client Lookup</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="kNumber">Client K Number <span class="required">*</span></label>
                        <input type="text" id="kNumber" placeholder="Enter K Number (e.g., K7807878)" 
                               pattern="^K\d{7}$" maxlength="8" required>
                        <div class="form-hint">Format: K followed by 7 digits (e.g., K7807878)</div>
                        <div id="kNumberError" class="validation-error hidden"></div>
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="button" class="btn btn-primary" onclick="lookupClient()">
                            Lookup Client
                        </button>
                    </div>
                </div>
                <div id="loadingIndicator" class="loading hidden">Looking up client...</div>
                <div id="clientStatus"></div>
            </div>

            <!-- Client Information Section -->
            <div id="clientSection" class="section hidden">
                <h3>üë§ Client Information</h3>
                
                <!-- K Number Display for New Clients -->
                <div id="kNumberDisplay" class="form-group hidden">
                    <label for="displayKNumber">K Number</label>
                    <input type="text" id="displayKNumber" readonly style="background-color: #f8f9fa;">
                    <div class="form-hint">This K Number will be assigned to the new client</div>
                </div>

                <!-- Basic Information -->
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">First Name <span class="required">*</span></label>
                        <input type="text" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name <span class="required">*</span></label>
                        <input type="text" id="lastName" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" placeholder="(902) 555-0123">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="client@example.com">
                    </div>
                </div>

                <!-- Address Information -->
                <h4 style="margin: 25px 0 15px 0; color: #2c3e50;">üìç Address Information</h4>
                <div class="form-group">
                    <label for="address">Street Address</label>
                    <input type="text" id="address" placeholder="123 Main Street">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City</label>
                        <input type="text" id="city" placeholder="Halifax">
                    </div>
                    <div class="form-group">
                        <label for="province">Province</label>
                        <select id="province">
                            <option value="NS">Nova Scotia</option>
                            <option value="NB">New Brunswick</option>
                            <option value="PE">Prince Edward Island</option>
                            <option value="NL">Newfoundland and Labrador</option>
                            <option value="ON">Ontario</option>
                            <option value="QC">Quebec</option>
                            <option value="MB">Manitoba</option>
                            <option value="SK">Saskatchewan</option>
                            <option value="AB">Alberta</option>
                            <option value="BC">British Columbia</option>
                            <option value="YT">Yukon</option>
                            <option value="NT">Northwest Territories</option>
                            <option value="NU">Nunavut</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="postalCode">Postal Code</label>
                        <input type="text" id="postalCode" placeholder="B3H 4R2">
                    </div>
                    <div class="form-group">
                        <label for="preferredDriver">Preferred Driver</label>
                        <select id="preferredDriver">
                            <option value="">No preference</option>
                            <option value="Andrew Newton">Andrew Newton</option>
                        </select>
                    </div>
                </div>

                <!-- Emergency Contact -->
                <h4 style="margin: 25px 0 15px 0; color: #2c3e50;">üö® Emergency Contact</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="emergencyContactName">Emergency Contact Name</label>
                        <input type="text" id="emergencyContactName" placeholder="Contact Name">
                    </div>
                    <div class="form-group">
                        <label for="emergencyContactNumber">Emergency Contact Phone</label>
                        <input type="tel" id="emergencyContactNumber" placeholder="(902) 555-0123">
                    </div>
                </div>

                <!-- Driver Requirements -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="requiresNonMaleDriver"> 
                        Requires non-male driver
                    </label>
                </div>

                <!-- Notes -->
                <div class="form-group">
                    <label for="notes">Additional Notes</label>
                    <textarea id="notes" rows="3" placeholder="Any special requirements or notes..."></textarea>
                </div>
            </div>

            <!-- Appointments Section -->
            <div id="appointmentsSection" class="section hidden">
                <h3>üìÖ Appointments</h3>
                <div id="existingAppointments"></div>
                <div id="newAppointments"></div>
                
                <button type="button" class="btn btn-secondary" onclick="addAppointment()">
                    + Add Appointment
                </button>
            </div>

            <!-- Save Section -->
            <div id="saveSection" class="section hidden">
                <div style="text-align: center;">
                    <button type="button" class="btn btn-success" onclick="saveClientData()" style="font-size: 18px; padding: 15px 40px;">
                        üíæ Save Client & Appointments
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_ENDPOINTS = {
            LOOKUP: 'https://n8n.newtonium.ca/webhook/rrts-2-client-lookup',
            SAVE: 'https://n8n.newtonium.ca/webhook/rrts-3-save-client-appointments'
        };

        // Global variables
        let isNewClient = false;
        let currentClient = null;
        let appointments = [];
        let appointmentCounter = 0;

        // K Number validation and formatting
        document.getElementById('kNumber').addEventListener('input', function(e) {
            let value = e.target.value.toUpperCase();
            
            // Remove any non-K or non-numeric characters except K at start
            if (value.length > 0 && !value.startsWith('K')) {
                value = 'K' + value.replace(/[^0-9]/g, '');
            }
            value = value.replace(/[^K0-9]/g, '');
            
            // Limit to K + 7 digits
            if (value.length > 8) {
                value = value.substring(0, 8);
            }
            
            e.target.value = value;
            
            // Validate format
            const isValid = /^K\d{7}$/.test(value) || value === '';
            const errorDiv = document.getElementById('kNumberError');
            
            if (value && !isValid) {
                errorDiv.textContent = 'K Number must be K followed by exactly 7 digits';
                errorDiv.classList.remove('hidden');
            } else {
                errorDiv.classList.add('hidden');
            }
        });

        // Client lookup function
        async function lookupClient() {
            const kNumber = document.getElementById('kNumber').value.trim();
            
            if (!kNumber) {
                showError('Please enter a K Number');
                return;
            }

            // Validate format
            if (!/^K\d{7}$/.test(kNumber)) {
                showError('Invalid K Number format. Must be K followed by 7 digits (e.g., K7807878)');
                return;
            }

            try {
                showLoading(true);
                
                const response = await fetch(API_ENDPOINTS.LOOKUP, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ kNumber: kNumber })
                });

                const result = await response.json();
                console.log('Client lookup result:', result);

                if (result.found) {
                    // Existing client found
                    loadClientData(result.clientData, result.appointments || []);
                    
                    // Count future appointments for display
                    const futureAppointments = (result.appointments || []).filter(apt => {
                        const appointmentDate = new Date(apt.date + ' ' + apt.time);
                        return appointmentDate > new Date();
                    });
                    
                    showClientStatus(`Client Found: ${result.clientData.firstName} ${result.clientData.lastName}${futureAppointments.length > 0 ? ` (${futureAppointments.length} future appointments)` : ''}`, 'found');
                } else {
                    // New client
                    setupNewClient(kNumber);
                    showClientStatus('New Client - Please fill out all information', 'new');
                }
            } catch (error) {
                console.error('Lookup error:', error);
                showError('Client lookup failed - please try again');
            }
        }

        // Setup for new client
        function setupNewClient(kNumber) {
            isNewClient = true;
            currentClient = null;
            appointments = [];
            appointmentCounter = 0;

            // Clear all form fields
            clearClientForm();
            
            // Show the K Number for new clients
            document.getElementById('displayKNumber').value = kNumber;
            document.getElementById('kNumberDisplay').classList.remove('hidden');
            
            // Show the form sections
            document.getElementById('clientSection').classList.remove('hidden');
            document.getElementById('appointmentsSection').classList.remove('hidden');
            document.getElementById('saveSection').classList.remove('hidden');
        }

        // Load existing client data
        function loadClientData(clientData, existingAppointments = []) {
            isNewClient = false;
            currentClient = clientData;

            // Hide K Number display for existing clients
            document.getElementById('kNumberDisplay').classList.add('hidden');

            // Populate client form fields
            document.getElementById('firstName').value = clientData.firstName || '';
            document.getElementById('lastName').value = clientData.lastName || '';
            document.getElementById('phone').value = clientData.phone || '';
            document.getElementById('email').value = clientData.email || '';
            document.getElementById('address').value = clientData.civicAddress || clientData.address || '';
            document.getElementById('city').value = clientData.city || '';
            document.getElementById('province').value = clientData.province || clientData.prov || 'NS';
            document.getElementById('postalCode').value = clientData.postalCode || '';
            document.getElementById('emergencyContactName').value = clientData.emergencyContactName || clientData.emergency_contact_name || '';
            document.getElementById('emergencyContactNumber').value = clientData.emergencyContactNumber || clientData.emergency_contact_number || '';
            document.getElementById('notes').value = clientData.notes || '';
            document.getElementById('preferredDriver').value = clientData.preferredDriver || clientData.preferreddriver || '';
            document.getElementById('requiresNonMaleDriver').checked = clientData.driver_gender_requirement === 'non-male';

            // Load existing appointments
            appointments = [];
            appointmentCounter = 0;
            
            if (existingAppointments && existingAppointments.length > 0) {
                console.log('üìÖ Loading existing appointments:', existingAppointments);
                
                // Sort appointments by date (soonest first)
                const sortedAppointments = existingAppointments.sort((a, b) => {
                    const dateA = new Date(a.date + ' ' + a.time);
                    const dateB = new Date(b.date + ' ' + b.time);
                    return dateA - dateB;
                });
                
                sortedAppointments.forEach(apt => {
                    const appointment = {
                        id: apt.id,
                        date: apt.date,
                        time: apt.time,
                        location: apt.location,
                        notes: apt.notes || '',
                        isExisting: true,
                        isModified: false,
                        isDeleted: false
                    };
                    appointments.push(appointment);
                    appointmentCounter++;
                });
            }

            renderAppointments();
            
            // Show the form sections
            document.getElementById('clientSection').classList.remove('hidden');
            document.getElementById('appointmentsSection').classList.remove('hidden');
            document.getElementById('saveSection').classList.remove('hidden');
        }

        // Clear client form
        function clearClientForm() {
            const formFields = ['firstName', 'lastName', 'phone', 'email', 'address', 'city', 'postalCode', 'emergencyContactName', 'emergencyContactNumber', 'notes'];
            formFields.forEach(field => {
                document.getElementById(field).value = '';
            });
            document.getElementById('province').value = 'NS';
            document.getElementById('preferredDriver').value = '';
            document.getElementById('requiresNonMaleDriver').checked = false;
        }

        // Add new appointment
        function addAppointment() {
            appointmentCounter++;
            const appointmentId = `appointment-${Date.now()}-${appointmentCounter}`;
            
            const appointment = {
                id: appointmentId,
                date: '',
                time: '',
                location: '',
                notes: '',
                isExisting: false,
                isModified: false,
                isDeleted: false,
                isDraft: true
            };
            
            appointments.push(appointment);
            renderAppointments();
        }

        // Render all appointments
        function renderAppointments() {
            const container = document.getElementById('existingAppointments');
            container.innerHTML = '';

            appointments.forEach((appointment, index) => {
                if (!appointment.isDeleted) {
                    const appointmentHtml = createAppointmentHtml(appointment, index);
                    container.appendChild(appointmentHtml);
                }
            });
        }

        // Create appointment HTML element
        function createAppointmentHtml(appointment, index) {
            const div = document.createElement('div');
            div.className = `appointment-item${appointment.isModified ? ' modified' : ''}`;
            
            const today = new Date().toISOString().split('T')[0];
            
            div.innerHTML = `
                <button type="button" class="delete-btn" onclick="deleteAppointment(${index})" title="Delete appointment">√ó</button>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Date <span class="required">*</span></label>
                        <input type="date" min="${today}" value="${appointment.date}" 
                               onchange="updateAppointment(${index}, 'date', this.value)" required>
                    </div>
                    <div class="form-group">
                        <label>Time <span class="required">*</span></label>
                        <input type="time" value="${appointment.time}" 
                               onchange="updateAppointment(${index}, 'time', this.value)" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Location <span class="required">*</span></label>
                        <select onchange="updateAppointment(${index}, 'location', this.value)" required>
                            <option value="">Select location</option>
                            <option value="New Minas Clinic" ${appointment.location === 'New Minas Clinic' ? 'selected' : ''}>New Minas Clinic</option>
                            <option value="Greenwood Clinic" ${appointment.location === 'Greenwood Clinic' ? 'selected' : ''}>Greenwood Clinic</option>
                            <option value="Middleton Clinic" ${appointment.location === 'Middleton Clinic' ? 'selected' : ''}>Middleton Clinic</option>
                            <option value="Other" ${appointment.location === 'Other' ? 'selected' : ''}>Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <input type="text" value="${appointment.notes}" placeholder="Special instructions..."
                               onchange="updateAppointment(${index}, 'notes', this.value)">
                    </div>
                </div>
                
                ${appointment.isExisting ? `<div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                    ${appointment.isModified ? '‚úèÔ∏è Modified' : 'üìã Existing appointment'}
                </div>` : '<div style="margin-top: 10px; font-size: 0.9em; color: #27ae60;">‚ûï New appointment</div>'}
            `;
            
            return div;
        }

        // Update appointment
        function updateAppointment(index, field, value) {
            appointments[index][field] = value;
            
            // Mark as modified if it's an existing appointment
            if (appointments[index].isExisting) {
                appointments[index].isModified = true;
            }
            
            // Mark as complete if all required fields are filled
            if (appointments[index].date && appointments[index].time && appointments[index].location) {
                appointments[index].isDraft = false;
            }
            
            renderAppointments();
        }

        // Delete appointment
        function deleteAppointment(index) {
            if (appointments[index].isExisting) {
                appointments[index].isDeleted = true;
            } else {
                appointments.splice(index, 1);
            }
            renderAppointments();
        }

        // Save client data
        async function saveClientData() {
            // Validate required fields
            const requiredFields = ['firstName', 'lastName'];
            let hasErrors = false;

            requiredFields.forEach(field => {
                const input = document.getElementById(field);
                if (!input.value.trim()) {
                    input.style.borderColor = '#e74c3c';
                    hasErrors = true;
                } else {
                    input.style.borderColor = '#e0e0e0';
                }
            });

            if (hasErrors) {
                showError('Please fill in all required fields');
                return;
            }

            // Validate appointments
            const validAppointments = appointments.filter(apt => 
                !apt.isDeleted && (!apt.isDraft || (apt.date && apt.time && apt.location))
            );

            if (validAppointments.length === 0) {
                showError('Please add at least one appointment');
                return;
            }

            try {
                showLoading(true);

                const clientData = {
                    kNumber: isNewClient ? document.getElementById('displayKNumber').value : currentClient.kNumber,
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    address: document.getElementById('address').value.trim(),
                    city: document.getElementById('city').value.trim(),
                    province: document.getElementById('province').value,
                    postalCode: document.getElementById('postalCode').value.trim(),
                    emergencyContactName: document.getElementById('emergencyContactName').value.trim(),
                    emergencyContactNumber: document.getElementById('emergencyContactNumber').value.trim(),
                    notes: document.getElementById('notes').value.trim(),
                    preferredDriver: document.getElementById('preferredDriver').value,
                    driverGenderRequirement: document.getElementById('requiresNonMaleDriver').checked ? 'non-male' : null
                };

                const requestData = {
                    isNewClient: isNewClient,
                    clientData: clientData,
                    appointments: validAppointments
                };

                console.log('Saving client data:', requestData);

                const response = await fetch(API_ENDPOINTS.SAVE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();
                console.log('Save result:', result);

                if (result.success) {
                    showSuccess(`Client and appointments saved successfully!`);
                    // Reset form after successful save
                    setTimeout(() => {
                        resetForm();
                    }, 3000);
                } else {
                    showError(result.error || 'Failed to save client data');
                }
            } catch (error) {
                console.error('Save error:', error);
                showError('Save operation failed - please try again');
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById('kNumber').value = '';
            document.getElementById('clientSection').classList.add('hidden');
            document.getElementById('appointmentsSection').classList.add('hidden');
            document.getElementById('saveSection').classList.add('hidden');
            document.getElementById('clientStatus').innerHTML = '';
            appointments = [];
            appointmentCounter = 0;
            isNewClient = false;
            currentClient = null;
        }

        // Utility functions
        function showLoading(show) {
            const indicator = document.getElementById('loadingIndicator');
            if (show) {
                indicator.classList.remove('hidden');
            } else {
                indicator.classList.add('hidden');
            }
        }

        function showError(message) {
            showLoading(false);
            const statusDiv = document.getElementById('clientStatus');
            statusDiv.innerHTML = `<div class="error">${message}</div>`;
        }

        function showSuccess(message) {
            showLoading(false);
            const statusDiv = document.getElementById('clientStatus');
            statusDiv.innerHTML = `<div class="client-status status-found">${message}</div>`;
        }

        function showClientStatus(message, type) {
            showLoading(false);
            const statusDiv = document.getElementById('clientStatus');
            statusDiv.innerHTML = `<div class="client-status status-${type}">${message}</div>`;
        }

        function logout() {
            // Redirect to main dashboard or login
            window.location.href = 'dashboard.html';
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('RRTS Client Management Portal Loaded');
            
            // Focus on K Number field initially
            document.getElementById('kNumber').focus();
            
            // Handle Enter key for lookup
            document.getElementById('kNumber').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    lookupClient();
                }
            });
        });

    </script>
</body>
</html>
<!-- 
Version: v1.0.0 - RRTS Client Management Portal
- v1.0.0: Initial client management page extracted from main admin portal
- Features: Client lookup, add/edit client info, appointment management
- Case-insensitive K-number search with format validation (K + 7 digits)
- K-number display field for new clients 
- Enhanced appointment management with existing appointment editing
- Responsive design with navigation header
- Complete form validation and error handling
- Ready for integration with existing RRTS workflows
-->